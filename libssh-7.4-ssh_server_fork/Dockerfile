# we need jessie because we have to have a openssl < 1.1
FROM debian:jessie-slim
ADD server.patch /
RUN apt-get update --assume-yes &&\
  apt-get upgrade --assume-yes &&\
  apt-get install --assume-yes cmake zlib1g-dev libssl-dev openssl build-essential libgcrypt20-dev heimdal-dev libsasl2-modules-gssapi-heimdal libgssapi3-heimdal xz-utils wget openssh-client
RUN wget https://www.libssh.org/files/0.7/libssh-0.7.4.tar.xz
RUN tar xf libssh-0.7.4.tar.xz
RUN cd libssh-0.7.4 && patch -p0 < /server.patch && mkdir build && cd build && cmake .. && make && make install 
RUN ssh-keygen -t dsa -f /root/ssh_host_dsa_key -N ''
RUN ssh-keygen -t rsa -b 2048 -f /root/ssh_host_rsa_key -N ''
EXPOSE 22
CMD ["/libssh-0.7.4/build/examples/ssh_server_fork", "-p", "22","-d", "/root/ssh_host_dsa_key", "-k", "/root/ssh_host_rsa_key","-v","0.0.0.0"]
